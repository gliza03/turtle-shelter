<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - Turtle Shelter Project</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Admin Portal Container -->
    <div class="admin-portal">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Turtle Shelter Admin</h2>
            </div>
            <ul class="nav-list">
                <li data-section="dashboard" class="nav-item active"><i class="fas fa-home"></i> Dashboard</li>
                <li data-section="event-management" class="nav-item"><i class="fas fa-calendar-alt"></i> Event Management</li>
                <li data-section="volunteers" class="nav-item"><i class="fas fa-users"></i> Users</li>
                <li data-section="reports" class="nav-item"><i class="fas fa-users"></i> Volunteers</li>
                <li data-section="settings" class="nav-item"><i class="fas fa-cog"></i> Settings</li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="admin-header">
                <h1>Welcome, Admin</h1>
                <button class="button button-outline">Logout</button>
            </header>

            <!-- Dynamic Sections -->
            <section id="dashboard" class="content-section active">
                <h2>Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Pending Event Approvals</h3>
                        <p>15</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>Total Volunteers</h3>
                        <p>120</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>Pending Approvals</h3>
                        <p>5</p>
                    </div>
                </div>
            </section>

            <section id="event-management" class="content-section">
                <h2>Event Management</h2>
                <p>Placeholder for pulling RDS event data and linking to Calendly.</p>
                <!-- Calendly inline widget begin -->
                <div class="calendly-inline-widget" data-url="https://calendly.com/intexgroup414/jacket-volunteering-event" style="min-width:320px;height:700px;"></div>
                <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async></script>
                <!-- Calendly inline widget end -->
                <div class="iframe-container">
                    <iframe src="https://calendar.google.com/calendar/embed?src=intexgroup414%40gmail.com&ctz=America%2FFort_Nelson" style="border: 0" width="800" height="600" frameborder="0" scrolling="no"></iframe>
                </div>
            </section>

            <section id="volunteers" class="content-section">
                <h2>Admin User Management</h2>
            
                <!-- Search Bar -->
                <div class="search-container" style="margin-bottom: 20px; text-align: center;">
                    <input
                        type="text"
                        id="adminSearch"
                        placeholder="Search by First or Last Name"
                        style="width: 80%; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;"
                    />
                </div>
            
                <div class="edit-account-container">
                    <h3>Edit User Accounts</h3>
                    <% accounts.forEach(account => { %>
                        <div class="admin-account" style="margin-bottom: 20px;" data-first-name="<%= account.account_first_name.toLowerCase() %>" data-last-name="<%= account.account_last_name.toLowerCase() %>">
                            <form action="/editAccount" method="POST" class="edit-account-form" style="display: inline-block; width: 48%; margin: 1%;">
                                <!-- Account ID (hidden field for reference) -->
                                <input type="hidden" id="accountId" name="account_id" value="<%= account.account_id %>">
                            
                                <!-- First Name -->
                                <label for="accountFirstName<%= account.account_id %>">First Name</label>
                                <input type="text" id="accountFirstName<%= account.account_id %>" name="account_first_name" value="<%= account.account_first_name %>" required>
                            
                                <!-- Last Name -->
                                <label for="accountLastName<%= account.account_id %>">Last Name</label>
                                <input type="text" id="accountLastName<%= account.account_id %>" name="account_last_name" value="<%= account.account_last_name %>" required>
                            
                                <!-- Username -->
                                <label for="accountUsername<%= account.account_id %>">Username</label>
                                <input type="text" id="accountUsername<%= account.account_id %>" name="account_username" value="<%= account.account_username %>" required>
                            
                                <!-- Email -->
                                <label for="accountEmail<%= account.account_id %>">Email</label>
                                <input type="email" id="accountEmail<%= account.account_id %>" name="account_email" value="<%= account.account_email %>" required>
                            
                                <!-- Role -->
                                <label for="accountRole<%= account.account_id %>">Role</label>
                                <select id="accountRole<%= account.account_id %>" name="role_id" required>
                                    <option value="1" <%= account.role_id === 1 ? 'selected' : '' %>>Normal</option>
                                    <option value="2" <%= account.role_id === 2 ? 'selected' : '' %>>Admin</option>
                                    <option value="3" <%= account.role_id === 3 ? 'selected' : '' %>>Super User</option>
                                </select>
                            
                                <!-- Submit Button -->
                                <button type="submit" class="button">Save Changes</button>
                            </form>
                            
                            <!-- Delete Button -->
                            <form action="/deleteAccount" method="POST" onsubmit="return confirm('Are you sure you want to delete this user?');" style="display: inline-block; width: 48%; margin: 1%; text-align: center;">
                                <input type="hidden" name="account_id" value="<%= account.account_id %>">
                                <button type="submit" class="button button-outline" style="background-color: red; color: white;">Delete</button>
                            </form>
                        </div>
                    <% }) %>
                    <div class="button-container" style="margin: 20px 0; text-align: center;">
                        <a href="/createaccount" class="button button-primary" style="display: inline-block; padding: 10px 20px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 5px; font-size: 16px; font-weight: bold;">
                            Create New Account
                        </a>
                    </div>
                </div>
            </section>
            
            <script>
                document.getElementById('adminSearch').addEventListener('input', (event) => {
                    const searchValue = event.target.value.toLowerCase();
                    const adminAccounts = document.querySelectorAll('.admin-account');
            
                    adminAccounts.forEach(account => {
                        const firstName = account.dataset.firstName;
                        const lastName = account.dataset.lastName;
            
                        if (firstName.includes(searchValue) || lastName.includes(searchValue)) {
                            account.style.display = 'block';
                        } else {
                            account.style.display = 'none';
                        }
                    });
                });
            </script>
            
                        

            <section id="reports" class="content-section">
                <h2>Volunteer Management</h2>

    <!-- Search Bar -->
    <div class="search-container">
        <label for="searchVolunteers">Search Volunteers:</label>
        <input type="text" id="searchVolunteers" placeholder="Search by name...">
    </div>

    <!-- Volunteer List -->
    <div id="volunteerList">
        <!-- Volunteer cards will be dynamically inserted here -->
    </div>

    <!-- Load More Button -->
    <button id="loadMoreVolunteers" class="button">Load More Volunteers</button>
</section>

<script>
    let currentPage = 1; // Pagination state
    const loadMoreButton = document.getElementById("loadMoreVolunteers");
    const volunteerList = document.getElementById("volunteerList");

    // Fetch Volunteers and Append to the List
    const fetchVolunteers = async (page = 1, searchQuery = "") => {
        try {
            const response = await fetch(`/volunteers?page=${page}&search=${searchQuery}`);
            const data = await response.json();

            // Append volunteers to the list
            data.volunteers.forEach(volunteer => {
                const volunteerCard = `
                    <div class="volunteer-card" data-id="${volunteer.volunteer_id}">
                        <h3>${volunteer.volunteer_first_name} ${volunteer.volunteer_last_name}</h3>
                        <p>Email: ${volunteer.volunteer_email}</p>
                        <p>Phone: ${volunteer.volunteer_phone_num}</p>
                        <p>Preferred Contact: ${volunteer.volunteer_preferred_communication}</p>
                        
                        <!-- Edit Button -->
                        <button class="button" onclick="editVolunteer(${volunteer.volunteer_id})">Edit</button>
                        
                        <!-- Delete Button -->
                        <button class="button button-outline" onclick="deleteVolunteer(${volunteer.volunteer_id})">Delete</button>
                    </div>
                `;
                volunteerList.insertAdjacentHTML("beforeend", volunteerCard);
            });

            // If no more volunteers, hide the load more button
            if (data.volunteers.length === 0) {
                loadMoreButton.style.display = "none";
            }
        } catch (error) {
            console.error("Error fetching volunteers:", error);
        }
    };

    // Load More Button Click Event
    loadMoreButton.addEventListener("click", () => {
        currentPage++;
        fetchVolunteers(currentPage);
    });

    // Delete Volunteer
    const deleteVolunteer = async (id) => {
        if (confirm("Are you sure you want to delete this volunteer?")) {
            try {
                const response = await fetch(`/volunteers/${id}`, { method: "DELETE" });
                if (response.ok) {
                    document.querySelector(`.volunteer-card[data-id="${id}"]`).remove();
                    alert("Volunteer deleted successfully!");
                } else {
                    alert("Failed to delete volunteer.");
                }
            } catch (error) {
                console.error("Error deleting volunteer:", error);
            }
        }
    };

    // Search Volunteers
    const searchInput = document.getElementById("searchVolunteers");
    searchInput.addEventListener("input", () => {
        const searchQuery = searchInput.value.trim();
        volunteerList.innerHTML = ""; // Clear existing list
        currentPage = 1; // Reset pagination
        fetchVolunteers(currentPage, searchQuery);
    });

    // Initial Load
    fetchVolunteers();
</script>
            

            <section id="settings" class="content-section">
                <h2>Settings</h2>
                <p>Placeholder for admin settings and configuration.</p>
            </section>
        </main>
    </div>
    <script src="script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.content-section');
    
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    // Remove 'active' class from previously active nav item and section
                    document.querySelector('.nav-item.active').classList.remove('active');
                    document.querySelector('.content-section.active').classList.remove('active');
    
                    // Add 'active' class to the clicked nav item
                    item.classList.add('active');
    
                    // Find the corresponding section by its ID and activate it
                    const sectionId = item.dataset.section;
                    document.getElementById(sectionId).classList.add('active');
                });
            });
        });
    </script>
    
</body>
</html>
